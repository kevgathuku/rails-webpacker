# README

This is a repo meant to replicate a bug in `yarn`

Getting started:

* Ruby version *2.5.1*
* Rails version *5.2.0*

* Yarn version *1.7.0*
* Node version *v10.6.0*

## To reproduce the bug:

Clone the repo:

    git clone git@github.com:kevgathuku/rails-webpacker.git

Install the ruby dependencies:

    bundle install

Install the npm dependencies (with verbose logging) by running:

    yarn install --verbose

There is a `postinstall` task that should run once all the dependencies are installed.
It should run the webpack build.

Here's the full content of the `scripts` field in `package.json`:

```
"scripts": {
    "postinstall": "./bin/webpack"
},
```

The `/bin/webpack` file that should be run is a `ruby` script that should create a webpack bundle via the `webpacker` gem.

### Expected behavior:

- The `postinstall` task should be run successfully once all dependencies are installed.

### Actual behaviour:

- The `postinstall` task fails with this error message:

```
yarn install v1.7.0
verbose 0.444 Checking for configuration file "/Users/kevin/code/ruby/rails-webpacker/.npmrc".
verbose 0.445 Checking for configuration file "/Users/kevin/.npmrc".
verbose 0.445 Found configuration file "/Users/kevin/.npmrc".
verbose 0.446 Checking for configuration file "/usr/local/etc/npmrc".
verbose 0.446 Checking for configuration file "/Users/kevin/code/ruby/rails-webpacker/.npmrc".
verbose 0.447 Checking for configuration file "/Users/kevin/code/ruby/.npmrc".
verbose 0.447 Checking for configuration file "/Users/kevin/code/.npmrc".
verbose 0.447 Checking for configuration file "/Users/kevin/.npmrc".
verbose 0.447 Found configuration file "/Users/kevin/.npmrc".
verbose 0.447 Checking for configuration file "/Users/.npmrc".
verbose 0.45 Checking for configuration file "/Users/kevin/code/ruby/rails-webpacker/.yarnrc".
verbose 0.45 Checking for configuration file "/Users/kevin/.yarnrc".
verbose 0.451 Found configuration file "/Users/kevin/.yarnrc".
verbose 0.451 Checking for configuration file "/usr/local/etc/yarnrc".
verbose 0.451 Checking for configuration file "/Users/kevin/code/ruby/rails-webpacker/.yarnrc".
verbose 0.451 Checking for configuration file "/Users/kevin/code/ruby/.yarnrc".
verbose 0.451 Checking for configuration file "/Users/kevin/code/.yarnrc".
verbose 0.452 Checking for configuration file "/Users/kevin/.yarnrc".
verbose 0.452 Found configuration file "/Users/kevin/.yarnrc".
verbose 0.452 Checking for configuration file "/Users/.yarnrc".
verbose 0.454 current time: 2018-07-23T21:22:51.718Z
[1/4] üîç  Resolving packages...
success Already up-to-date.
$ ./bin/webpack
Could not find rake-12.3.1 in any of the sources
Run `bundle install` to install missing gems.
verbose 1.524 Error: Command failed with exit code 7.
    at MessageError.ExtendableBuiltin (/usr/local/Cellar/yarn/1.7.0/libexec/lib/cli.js:243:66)
    at new MessageError (/usr/local/Cellar/yarn/1.7.0/libexec/lib/cli.js:272:123)
    at /usr/local/Cellar/yarn/1.7.0/libexec/lib/cli.js:37577:15
    at Generator.throw (<anonymous>)
    at step (/usr/local/Cellar/yarn/1.7.0/libexec/lib/cli.js:98:30)
    at /usr/local/Cellar/yarn/1.7.0/libexec/lib/cli.js:111:13
    at <anonymous>
    at process._tickCallback (internal/process/next_tick.js:188:7)
error Command failed with exit code 7.
info Visit https://yarnpkg.com/en/docs/cli/install for documentation about this command.
```

### More info

Contents of `~/.npmrc`:

```
prefix=${HOME}/npm-global
```

Contents of `~/.yarnrc`

```
# THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.
# yarn lockfile v1


lastUpdateCheck 1532345447439
```

When installing the dependencies via `npm install` the `postinstall` step runs successfully.
